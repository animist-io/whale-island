<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

# isValidExpirationDate

[lib/events.js:49-62](https://github.com/animist-io/whale-island/blob/825fe590ce498a769d76328d8bb1384e84d96752/lib/events.js#L49-L62 "Source code on GitHub")

Validates `expires` arg of a message publication event log. Duration must at least 1 sec and
smaller than the max value of uint32. Returns false if `expires` is before `Date.now()`.

**Parameters**

-   `expires` **BigNumber** date (ms since Epoch) that broadcast should end.

Returns **[Boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** true if duration valid, false otherwise.

# isValidMessage

[lib/events.js:70-72](https://github.com/animist-io/whale-island/blob/825fe590ce498a769d76328d8bb1384e84d96752/lib/events.js#L70-L72 "Source code on GitHub")

Validates message arg of a message publication event log. Message must be non-null and
less than or equal to `config.MAX_MESSAGE_LENGTH`

**Parameters**

-   `message` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** 

Returns **[Boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** true if message is valid, false otherwise.

# isValidMessagePublicationEvent

[lib/events.js:79-85](https://github.com/animist-io/whale-island/blob/825fe590ce498a769d76328d8bb1384e84d96752/lib/events.js#L79-L85 "Source code on GitHub")

Validates message publication event data.

**Parameters**

-   `event` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** `{ uuid: <uuid string>, message: <string>, expires: <date in ms> }`

Returns **[Boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** true if data validates, false otherwise.

# isValidPresenceVerificationEvent

[lib/events.js:92-97](https://github.com/animist-io/whale-island/blob/825fe590ce498a769d76328d8bb1384e84d96752/lib/events.js#L92-L97 "Source code on GitHub")

Validates presence verification request event data

**Parameters**

-   `event` **Objects** `{ account: <address>, contract: <address>}` }

Returns **[Boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** True if data validates, false otherwise.

# getLastSavedBlock

[lib/events.js:107-111](https://github.com/animist-io/whale-island/blob/825fe590ce498a769d76328d8bb1384e84d96752/lib/events.js#L107-L111 "Source code on GitHub")

Retrieves last block for which an event was logged. This allows whale-island to synch its
events db to blockchain if it's been turned off without filtering for every event since
the node's genesis block

**Parameters**

-   `db` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** Event DB

Returns **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** Block number

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)** Result of db.get OR device genesis block if DB is new.

# saveBlock

[lib/events.js:119-124](https://github.com/animist-io/whale-island/blob/825fe590ce498a769d76328d8bb1384e84d96752/lib/events.js#L119-L124 "Source code on GitHub")

Saves blocknumber of most recently logged event. This value serves as a starting point for the
events logs filters run by the `start. . .EventFilter` methods

**Parameters**

-   `db` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** Event DB
-   `block` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** Current block number

# addPresenceVerificationRequest

[lib/events.js:130-135](https://github.com/animist-io/whale-island/blob/825fe590ce498a769d76328d8bb1384e84d96752/lib/events.js#L130-L135 "Source code on GitHub")

Adds a presenceVerification request to the animistEvents db. Does not allow duplicate clients.

**Parameters**

-   `event` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** `{account: <address>, contractAddress: <address>}`

# generateRandom2ByteInt

[lib/events.js:141-143](https://github.com/animist-io/whale-island/blob/825fe590ce498a769d76328d8bb1384e84d96752/lib/events.js#L141-L143 "Source code on GitHub")

Generates a random value within the limits of allowed major and minor beacon values

Returns **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** a value between 0 and 65535 inclusive

# generateBeaconSignature

[lib/events.js:155-173](https://github.com/animist-io/whale-island/blob/825fe590ce498a769d76328d8bb1384e84d96752/lib/events.js#L155-L173 "Source code on GitHub")

Combines requested beacon uuid and randomly generated major and minor
values into a string with form: `<uuid>:<major>:<minor>`.
Signs this with the node account and formats it for
client's `submitSignedBeaconId` Solidity contract method

**Parameters**

-   `uuid` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** v4 uuid
-   `major` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** Integer btw 0 and 65535
-   `minor` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** Integer btw 0 and 65535

Returns **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** EC sig obj that Solidity will parse correctly

# startPresenceVerificationRequestsFilter

[lib/events.js:184-208](https://github.com/animist-io/whale-island/blob/825fe590ce498a769d76328d8bb1384e84d96752/lib/events.js#L184-L208 "Source code on GitHub")

Starts filtering for presence verfication request events, from proximityEvents DB's
`lastBlock` to 'latest'. Validates event data, saves it and updates 'lastBlock' value to the
event's blockNumber.

**Parameters**

-   `eventsContractAddress` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** Address of the deployed AnimistEvents contract
-   `cb` **[Function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function)** (Optional) Callback to execute when an event is logged and saved in the DB

# startMessagePublicationRequestsFilter

[lib/events.js:218-236](https://github.com/animist-io/whale-island/blob/825fe590ce498a769d76328d8bb1384e84d96752/lib/events.js#L218-L236 "Source code on GitHub")

Starts filtering for message publication request events. Validates event data and invokes
`server`'s addPublication method for each event.

**Parameters**

-   `eventsContractAddress` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** Address of the deployed AnimistEvents contract
-   `successCb` **[Function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function)** Success callback to pass event data to so server can cast it.
-   `errorCb` **[Function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function)** (Optional) Callback to execute when an event is logged.

# startBeaconBroadcastRequestsFilter

[lib/events.js:246-274](https://github.com/animist-io/whale-island/blob/825fe590ce498a769d76328d8bb1384e84d96752/lib/events.js#L246-L274 "Source code on GitHub")

Starts filtering for beacon broadcast request events. Validates event data and invokes `server`'s
`addPublication` method for each event.

**Parameters**

-   `eventsContractAddress` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** Address of the deployed AnimistEvents contract
-   `addBeacon` **[Function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function)** Callback to pass event data to so beacon can cast it.
-   `cb` **[Function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function)** (Optional) Callback to execute when an event is logged.
